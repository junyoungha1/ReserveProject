<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<head th:replace="pc/fragments/header :: header"/>
<body>
<div th:replace="pc/fragments/bodyHeader :: bodyHeader"/>
<div class="view">
    <form role="form" action="/member/new" th:object="${memberForm}" method="post">
        <div class="form-group">
            <label th:for="name">이름</label>

            <input type="text" th:field="*{name}" class="form-control" placeholder="이름을 입력하세요"
                   th:class="${#fields.hasErrors('name')}? 'form-control fieldError' : 'form-control'">
            <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Incorrect date</p>
        </div>
        <div class="form-group">
            <label th:for="regNum">주민등록번호</label>
            <input type="text" th:field="*{regNum1}" class="form-control">
            <span>-</span>
            <input type="text" th:field="*{regNum2}" class="form-control">
        </div>
        <div class="form-group">
            <label th:for="loginId">ID</label>
            <input type="text" th:field="*{loginId}" class="form-control" placeholder="ID를 입력하세요">
            <p th:if="${#fields.hasErrors('loginId')}" th:errors="*{loginId}">Incorrect date</p>
        </div>
        <div class="form-group">
            <label th:for="pw">PW</label>
            <input type="text" th:field="*{pw}" class="form-control" placeholder="pw를 입력하세요">
        </div>
        <div class="form-group">
            <label th:for="address">Address</label>
            <input type="text" th:field="*{address}" class="form-control" placeholder="주소를 입력하세요">
        </div>
        <div class="form-group">
            <label th:for="phone">Phone</label>
            <input type="text" id="phoneNumber" th:field="*{phone}" class="form-control" placeholder="Phone을 입력하세요">
            <input type="button" id="phoneBtn" onclick="sendPhone()" value="인증 번호 발송"/>
        </div>
        <div id="authNumberInput" style="display: none;">
            <div class="form-group">
                <label th:for="authNumber">인증번호</label>
                <input type="text" id="authNumber" class="form-control" placeholder="인증번호를 입력하세요">
                <input type="button" id="authBtn" onclick="AuthCode()" value="확인"/>
            </div>
        </div>
            <div class="form-group">
                <label th:for="email">Email</label>
                <input type="text" id="email" th:field="*{email}" class="form-control" placeholder="Email을 입력하세요">
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">가입</button>
            </div>
    </form>
</div>
<div th:replace="pc/fragments/footer :: footer"/>
</body>
<script>
    function sendPhone() {
        if ($("#phoneNumber").val()) {
            let query = {
                phoneNumber: $("#phoneNumber").val()
            };
            console.log($("#phoneNumber").val());
            $.ajax({
                type: "post",
                url: "/sendMsg",
                data: query,
                success: function (data) {
                    if (data == "false") {
                        swal('중복체크', '이미 가입된 번호입니다.', 'error');
                        $("#phoneNumber").val('');
                    } else {
                        swal('인증 성공', '인증 번호가 발송 되었습니다.', 'success');
                        $("#phoneNumber").prop('disabled', true);
                        $("#authNumberInput").show();
                        $("#phoneBtn").val("재전송");
                        $("#authNumber").focus();
                    }
                },  error:function(request,status,error){

                    console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);

                }
            })
        }
    }

    function AuthCode() {

        if ($("#authNumber").val()) {
            let query = {
                code: $("#authNumber").val()

            };

            $.ajax({
                type: "post",
                url: "/phoneAuth",
                data: query,
                success: function (data) {
                    if (data == "false") {
                        swal('입력 오류', '인증번호가 일치하지 않습니다.', 'error');
                        $("#authNumber").val('');
                    } else {
                        swal('인증 성공', '인증이 완료되었습니다.', 'success');
                        $("#authNumber").prop('disabled', true);
                        $("#phoneBtn").hide();
                        $("#authBtn").hide();
                        $("#email").focus();
                    }
                }
            });
        }
    }
</script>
</html>
